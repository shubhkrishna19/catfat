{{ 'component-list-menu.css' | asset_url | stylesheet_tag }}
{{ 'component-search.css' | asset_url | stylesheet_tag }}
{{ 'component-menu-drawer.css' | asset_url | stylesheet_tag }}
{{ 'component-cart-notification.css' | asset_url | stylesheet_tag }}

<style>
  :root {
    --header-primary-color: {{ section.settings.primary_color }};
    --header-accent-color: {{ section.settings.accent_color }};
    --header-hover-color: {{ section.settings.hover_color }};
  }

  /* Bigger Header Styles */
  .header {
    padding: 2.5rem 0;
    background: linear-gradient(135deg, #ff6b9d, #e84a7f);
  }

  .header a,
  .header__menu-item,
  .header__icon {
    color: #fff !important;
  }

  .header__heading-link {
    padding: 0.5rem 0;
  }

  .header__heading-logo-wrapper {
    max-width: {{ section.settings.logo_width | times: 2 }}px;
  }

  .header__heading-logo {
    height: auto;
    max-height: none;
  }

  .header__heading {
    display: flex;
    flex-direction: column;
  }

  .header__heading .h2 {
    font-size: 3rem;
    font-weight: 800;
    letter-spacing: -0.02em;
    color: #fff !important;
    margin: 0;
    line-height: 1;
  }

  .header__tagline {
    font-size: 1rem;
    font-weight: 400;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.9);
    margin-top: 0.3rem;
  }

  .header__inline-menu {
    padding: 0 2rem;
  }

  .header__menu-item {
    font-size: 1.1rem;
    font-weight: 600;
    padding: 1.2rem 1.5rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #fff;
  }

  .header__icons {
    gap: 2rem;
  }

  .header__icon {
    padding: 0.8rem;
  }

  .header__icon svg {
    width: 28px;
    height: 28px;
  }

  @media screen and (min-width: 990px) {
    .header__heading .h2 {
      font-size: 3.5rem;
    }

    .header__inline-menu {
      padding: 0 3rem;
    }
  }

  header-drawer {
    justify-self: start;
    margin-left: -1.2rem;
  }

  .menu-drawer-container {
    display: flex;
  }

  .list-menu {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .list-menu--inline {
    display: inline-flex;
    flex-wrap: wrap;
    gap: 2rem;
  }

  summary.list-menu__item {
    padding: 1.2rem 1.5rem;
    text-decoration: none;
    letter-spacing: 0.06rem;
    text-transform: uppercase;
  }

  /* Mega Menu Styles */
  .mega-menu {
    position: static;
  }

  .mega-menu__content {
    display: none;
    position: absolute;
    left: 0;
    right: 0;
    background: #fff;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    padding: 3rem;
    z-index: 100;
    border-top: 3px solid var(--header-primary-color);
  }

  .menu-item:hover .mega-menu__content,
  .menu-item:focus-within .mega-menu__content {
    display: block;
  }

  .mega-menu__grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 3rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  .mega-menu__category {
    font-weight: 600;
    color: var(--header-accent-color);
    margin-bottom: 1rem;
    font-size: 1.1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .mega-menu__links {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .mega-menu__links li {
    margin-bottom: 0.8rem;
  }

  .mega-menu__links a {
    color: #333;
    text-decoration: none;
    font-size: 0.95rem;
    transition: color 0.2s ease;
  }

  .mega-menu__links a:hover {
    color: var(--header-primary-color);
  }

  .mega-menu__image {
    display: block;
    overflow: hidden;
    border-radius: 8px;
  }

  .mega-menu__image img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .mega-menu__image:hover img {
    transform: scale(1.05);
  }

  /* Header Menu Styles */
  .header__menu-item {
    position: relative;
    padding: 1rem 0;
    font-weight: 500;
  }

  .header__menu-item::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--header-primary-color);
    transition: width 0.3s ease;
  }

  .header__menu-item:hover::after {
    width: 100%;
  }

  .header__submenu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 220px;
    background: #fff;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    border-radius: 0 0 8px 8px;
    padding: 1rem 0;
    z-index: 50;
  }

  .menu-item:hover .header__submenu {
    display: block;
  }

  .header__submenu a {
    display: block;
    padding: 0.6rem 1.5rem;
    color: #333;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .header__submenu a:hover {
    background: rgba(255, 107, 157, 0.1);
    color: var(--header-primary-color);
  }

  /* Header Colors - Using gradient background */
  .header {
    background: linear-gradient(135deg, #ff6b9d, #e84a7f) !important;
    padding: 2.5rem 0;
    color: #fff;
  }

  .header a,
  .header__menu-item,
  .header__icon,
  .header .h2,
  .header span,
  .header .link {
    color: #fff !important;
  }

  .header svg {
    fill: #fff !important;
  }

  .header__menu-item:hover {
    color: rgba(255, 255, 255, 0.8) !important;
  }

  .header__active-menu-item {
    color: var(--header-primary-color);
  }

  /* Cart Badge */
  .cart-count-bubble {
    position: absolute;
    top: -5px;
    right: -8px;
    background: var(--header-primary-color);
    color: #fff;
    font-size: 0.7rem;
    font-weight: 600;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Mobile Styles */
  @media screen and (max-width: 768px) {
    .header__inline-menu {
      display: none;
    }

    .mega-menu__grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .mega-menu__image {
      display: none;
    }
  }

  /* Search Overlay */
  .search-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .search-modal.active {
    display: flex;
  }

  .search-modal__content {
    background: #fff;
    padding: 2rem;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    position: relative;
  }

  .search-modal__close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
  }

  .search-modal input {
    width: 100%;
    padding: 1rem;
    border: 2px solid #eee;
    border-radius: 8px;
    font-size: 1.1rem;
  }

  .search-modal input:focus {
    outline: none;
    border-color: var(--header-primary-color);
  }
</style>

<header class="header header--top-center page-width{% if section.settings.menu != blank %} header--has-menu{% endif %}{% if section.settings.header_size == 'big' %} header--big{% endif %}">
  {%- if section.settings.menu != blank -%}
    <header-drawer class="header__icon--menu">
      <details class="menu-drawer-container">
        <summary class="header__icon header__icon--menu header__icon--summary link link--text focus-inset" aria-label="{{ 'sections.header.menu' | t }}">
          <span>
            {% render 'icon-hamburger' %}
            {% render 'icon-close' %}
          </span>
        </summary>
        <div id="menu-drawer" class="gradient menu-drawer motion-reduce" tabindex="-1">
          <div class="menu-drawer__inner-container">
            <div class="menu-drawer__navigation-container">
              <nav class="menu-drawer__navigation">
                <ul class="menu-drawer__menu has-submenu list-menu" role="list">
                  {%- for link in section.settings.menu.links -%}
                    <li>
                      {%- if link.links != blank -%}
                        <details id="Details-menu-drawer-menu-item-{{ forloop.index }}">
                          <summary class="menu-drawer__menu-item list-menu__item link link--text focus-inset{% if link.child_active %} menu-drawer__menu-item--active{% endif %}">
                            {{ link.title | escape }}
                            {% render 'icon-caret' %}
                          </summary>
                          <div id="link-{{ link.title | escape }}" class="menu-drawer__submenu has-submenu motion-reduce" tabindex="-1">
                            <div class="menu-drawer__inner-submenu">
                              <ul class="menu-drawer__menu list-menu" role="list" tabindex="-1">
                                {%- for childlink in link.links -%}
                                  <li>
                                    <a href="{{ childlink.url }}" class="menu-drawer__menu-item link link--text list-menu__item focus-inset{% if childlink.current %} menu-drawer__menu-item--active{% endif %}"{% if childlink.current %} aria-current="page"{% endif %}>
                                      {{ childlink.title | escape }}
                                    </a>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </div>
                          </div>
                        </details>
                      {%- else -%}
                        <a href="{{ link.url }}" class="menu-drawer__menu-item list-menu__item link link--text focus-inset{% if link.current %} menu-drawer__menu-item--active{% endif %}"{% if link.current %} aria-current="page"{% endif %}>
                          {{ link.title | escape }}
                        </a>
                      {%- endif -%}
                    </li>
                  {%- endfor -%}
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </details>
    </header-drawer>
  {%- endif -%}

  <a href="{{ routes.root_url }}" class="header__heading-link link link--text">
    {%- if settings.logo != blank -%}
      <div class="header__heading-logo-wrapper">
        {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
        {%- assign logo_height = settings.logo_width | divided_by: settings.logo.aspect_ratio -%}
        {{ settings.logo | image_url: width: settings.logo_width | image_tag: class: 'header__heading-logo motion-reduce', widths: '50, 100, 150, 200, 250, 300, 400, 500', height: logo_height, width: settings.logo_width, alt: logo_alt }}
      </div>
    {%- else -%}
      <div class="header__heading">
        <span class="h2">{{ shop.name }}</span>
        <p class="header__tagline">Premium Lunch Boxes & Bottles</p>
      </div>
    {%- endif -%}
  </a>

  <nav class="header__inline-menu">
    <ul class="list-menu list-menu--inline" role="list">
      {%- if section.settings.menu != blank -%}
        {%- for link in section.settings.menu.links -%}
        <li class="menu-item{% if link.links != blank %} mega-menu{% endif %}">
          {%- if link.links != blank -%}
            <details class="menu-item">
              <summary class="header__menu-item list-menu__item link link--text focus-inset">
                <span {%- if link.child_active %} class="header__active-menu-item"{% endif %}>{{ link.title | escape }}</span>
                {% render 'icon-caret' %}
              </summary>
              {%- if link.levels == 2 -%}
                <ul class="header__submenu list-menu" role="list" tabindex="-1">
                  {%- for childlink in link.links -%}
                    <li>
                      <a href="{{ childlink.url }}" class="header__menu-item list-menu__item link link--text focus-inset"{% if childlink.current %} aria-current="page"{% endif %}>
                        {{ childlink.title | escape }}
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              {%- else -%}
                <div class="mega-menu__content">
                  <div class="mega-menu__grid">
                    {%- for childlink in link.links -%}
                      <div class="mega-menu__column">
                        <div class="mega-menu__category">{{ childlink.title | escape }}</div>
                        {%- if childlink.links != blank -%}
                          <ul class="mega-menu__links">
                            {%- for sublink in childlink.links -%}
                              <li><a href="{{ sublink.url }}">{{ sublink.title | escape }}</a></li>
                            {%- endfor -%}
                          </ul>
                        {%- endif -%}
                      </div>
                    {%- endfor -%}
                    {%- if section.settings.mega_menu_image != blank -%}
                      <div class="mega-menu__column">
                        <a href="{{ section.settings.mega_menu_link }}" class="mega-menu__image">
                          {{ section.settings.mega_menu_image | image_url: width: 300 | image_tag: loading: 'lazy' }}
                        </a>
                      </div>
                    {%- endif -%}
                  </div>
                </div>
              {%- endif -%}
            </details>
          {%- else -%}
            <a href="{{ link.url }}" class="header__menu-item list-menu__item link link--text focus-inset"{% if link.current %} aria-current="page"{% endif %}>
              <span {%- if link.current %} class="header__active-menu-item"{% endif %}>{{ link.title | escape }}</span>
            </a>
          {%- endif -%}
        </li>
        {%- endfor -%}
      {%- else -%}
        <li class="menu-item">
          <a href="{{ routes.root_url }}" class="header__menu-item">
            <span>Home</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="{{ routes.all_products_collection_url }}" class="header__menu-item">
            <span>Shop All</span>
          </a>
        </li>
        <li class="menu-item mega-menu">
          <details class="menu-item">
            <summary class="header__menu-item">
              <span>Categories</span>
              {% render 'icon-caret' %}
            </summary>
            <div class="mega-menu__content">
              <div class="mega-menu__grid">
                <div class="mega-menu__column">
                  <div class="mega-menu__category">Lunch Boxes</div>
                  <ul class="mega-menu__links">
                    <li><a href="{{ routes.collections_url }}/lunch-box">All Lunch Boxes</a></li>
                    <li><a href="{{ routes.collections_url }}/steel-lunch-box">Steel Lunch Boxes</a></li>
                    <li><a href="{{ routes.collections_url }}/plastic-lunch-box">Plastic Lunch Boxes</a></li>
                    <li><a href="{{ routes.collections_url }}/insulated-lunch-box">Insulated</a></li>
                  </ul>
                </div>
                <div class="mega-menu__column">
                  <div class="mega-menu__category">Bottles</div>
                  <ul class="mega-menu__links">
                    <li><a href="{{ routes.collections_url }}/bottles">All Bottles</a></li>
                    <li><a href="{{ routes.collections_url }}/steel-bottle">Steel Bottles</a></li>
                    <li><a href="{{ routes.collections_url }}/plastic-bottle">Plastic Bottles</a></li>
                    <li><a href="{{ routes.collections_url }}/thermos">Thermos</a></li>
                  </ul>
                </div>
                <div class="mega-menu__column">
                  <div class="mega-menu__category">By Age</div>
                  <ul class="mega-menu__links">
                    <li><a href="{{ routes.collections_url }}/kids">Kids</a></li>
                    <li><a href="{{ routes.collections_url }}/adults">Adults</a></li>
                    <li><a href="{{ routes.collections_url }}/office">Office Use</a></li>
                    <li><a href="{{ routes.collections_url }}/school">School</a></li>
                  </ul>
                </div>
                <div class="mega-menu__column">
                  <div class="mega-menu__category">Shop</div>
                  <ul class="mega-menu__links">
                    <li><a href="{{ routes.collections_url }}/new-arrivals">New Arrivals</a></li>
                    <li><a href="{{ routes.collections_url }}/best-sellers">Best Sellers</a></li>
                    <li><a href="{{ routes.collections_url }}/sale">Sale</a></li>
                    <li><a href="{{ routes.collections_url }}/combo-sets">Combo Sets</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </details>
        </li>
        <li class="menu-item">
          <a href="{{ routes.blogs_url }}" class="header__menu-item">
            <span>Blog</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="{{ routes.pages_url }}/contact" class="header__menu-item">
            <span>Contact</span>
          </a>
        </li>
      {%- endif -%}
    </ul>
  </nav>

  <div class="header__icons{% if section.settings.enable_customer_avatar %} header-account--logged-out{% endif %}">
    <div class="desktop-cart-wrapper">
      <button class="header__icon header__icon--search link link--text focus-inset" id="search-toggle">
        {% render 'icon-search' %}
        <span class="visually-hidden">
          {{ 'general.search.search' | t }}
        </span>
      </button>
    </div>

    {%- if shop.customer_accounts_enabled -%}
      <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" class="header__icon header__icon--account link focus-inset{% if section.settings.menu != blank %} small-hide{% endif %}">
        {% render 'icon-account' %}
        <span class="visually-hidden">
          {%- liquid
            if customer
              echo 'customer.account_fallback' | t
            else
              echo 'customer.log_in' | t
            endif
          -%}
        </span>
      </a>
    {%- endif -%}

    <a href="{{ routes.cart_url }}" class="header__icon header__icon--cart link focus-inset" id="cart-icon-bubble">
      {% render 'icon-cart' %}
      <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
      {%- if cart.item_count > 0 -%}
        <div class="cart-count-bubble">
          <span aria-hidden="true">{{ cart.item_count }}</span>
        </div>
      {%- endif -%}
    </a>
  </div>
</header>

<div class="search-modal" id="search-modal">
  <div class="search-modal__content">
    <button class="search-modal__close" id="search-close">&times;</button>
    <form action="{{ routes.search_url }}" method="get" role="search">
      <input type="search" name="q" placeholder="Search for products..." autocomplete="off">
      <button type="submit" class="button button--primary" style="margin-top: 1rem; width: 100%;">Search</button>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchToggle = document.getElementById('search-toggle');
    const searchModal = document.getElementById('search-modal');
    const searchClose = document.getElementById('search-close');

    if (searchToggle && searchModal) {
      searchToggle.addEventListener('click', () => {
        searchModal.classList.add('active');
        searchModal.querySelector('input').focus();
      });

      searchClose?.addEventListener('click', () => {
        searchModal.classList.remove('active');
      });

      searchModal.addEventListener('click', (e) => {
        if (e.target === searchModal) {
          searchModal.classList.remove('active');
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && searchModal.classList.contains('active')) {
          searchModal.classList.remove('active');
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "header",
      "content": "Menu"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "checkbox",
      "id": "enable_customer_avatar",
      "default": true,
      "label": "Show customer avatar"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "primary_color",
      "default": "#ff6b9d",
      "label": "Primary Color (Pink)"
    },
    {
      "type": "color",
      "id": "accent_color",
      "default": "#e84a7f",
      "label": "Accent Color (Deep Pink)"
    },
    {
      "type": "color",
      "id": "hover_color",
      "default": "#ff8e53",
      "label": "Hover Color (Coral)"
    },
    {
      "type": "color",
      "id": "header_background",
      "default": "#ffffff",
      "label": "Header Background"
    },
    {
      "type": "color",
      "id": "text_color",
      "default": "#333333",
      "label": "Text Color"
    },
    {
      "type": "header",
      "content": "Mega Menu"
    },
    {
      "type": "image_picker",
      "id": "mega_menu_image",
      "label": "Mega Menu Promo Image"
    },
    {
      "type": "url",
      "id": "mega_menu_link",
      "label": "Mega Menu Link"
    }
  ]
}
{% endschema %}
